<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>动态系统稳定性与 Lotka-Volterra 模型浅略研究</title>
      <link href="/2026/01/12/Lotka-Volterra_model/"/>
      <url>/2026/01/12/Lotka-Volterra_model/</url>
      
        <content type="html"><![CDATA[<h2 id="稳定性理论（Stability-theory）"><a href="#稳定性理论（Stability-theory）" class="headerlink" title="稳定性理论（Stability theory）"></a>稳定性理论（Stability theory）</h2><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>稳定性理论研究微分方程的解及动态系统的轨迹在初始条件有微小扰动时的稳定性.在某初始平衡条件（Equilibrium）下，给系统向某一方向施加一微小扰动，若系统最终可能偏离平衡状态而无法回到原始位置，则该平衡点是<strong>不稳定</strong>的.反之，若为稳定平衡点，则最终能回到原始位置，如摆线的振荡、阻尼振子等系统.</p><figure>    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/1/19/DampedCosine.svg/500px-DampedCosine.svg.png" alt="阻尼振荡">    <figcaption>衰减的阻尼正弦波.来自：Wikipedia.</figcaption></figure><h3 id="稳定性的判断"><a href="#稳定性的判断" class="headerlink" title="稳定性的判断"></a>稳定性的判断</h3><p>动态系统可用微分方程来描述.对于一维的常微分方程如 $\frac{dx}{dt} &#x3D; f(x)$，其平衡点 ${x^*}$ 满足 $f(x^\ast) &#x3D; 0$.若 $f’(x^\ast) &lt; 0$，则平衡点是稳定的；若 $f’(x^\ast) &gt; 0$，则平衡点是不稳定的.值得注意的是，若 $f’(x^\ast) &#x3D; 0$（如下图第二个 stable 处），则需要其他方法判断稳定性.</p><figure>    <img src="https://github.com/Louis-wemby/Louis-wemby.github.io/blob/main/blog/source/figure/posts/Lotka-Volterra_model/1D_stability.png?raw=true" alt="一维稳定性判断">    <figcaption>一维动态系统的稳定性判断.</figcaption></figure><p>而对于二维系统 $\frac{dx}{dt} &#x3D; f_1(x_1, x_2)$ 和 $\frac{dy}{dt} &#x3D; f_2(x_1, x_2)$，其平衡点 $(x^\ast, y^\ast)$ 满足 $f_1(x^\ast, y^\ast) &#x3D; 0$ 和 $f_2(x^\ast, y^\ast) &#x3D; 0$.通过线性化方法，可以构造类似雅可比矩阵（Jacobian matrix）：</p><p>$$<br>\mathbf{J} - \lambda \mathbf{I} &#x3D;<br>\begin{bmatrix}<br>\frac{\partial f_1}{\partial x_1} - \lambda &amp;<br>\frac{\partial f_1}{\partial x_2} \\<br>\frac{\partial f_2}{\partial x_1} &amp;<br>\frac{\partial f_2}{\partial x_2} - \lambda<br>\end{bmatrix}<br>\tag {1}<br>$$</p><p>通过求解特征值 $\lambda$，可以判断平衡点的稳定性：</p><ul><li>若实部均为<strong>负</strong>，则平衡点是<strong>稳定</strong>的（Stable Node）；</li><li>若实部均为<strong>正</strong>，则平衡点是<strong>不稳定</strong>的（Unstable Node）；</li><li>若实部<strong>异号</strong>，则平衡点是<strong>鞍点</strong>（Saddle Point），亦不稳定.</li></ul><p>即 $(x_1,x_2)$ 为稳定点的充要条件为：</p><p>当</p><p>$$<br>\mathbf{J}- \lambda \mathbf{I} &#x3D; 0 \tag{2}<br>$$</p><p>时，</p><p>$$<br>\text{Re}\lambda _{1,2} &lt; 0 \tag{3}<br>$$</p><figure>    <img src="https://github.com/Louis-wemby/Louis-wemby.github.io/blob/main/blog/source/figure/posts/Lotka-Volterra_model/2D_stability.png?raw=true" alt="二维稳定性判断">    <figcaption>二维动态系统的稳定性判断.</figcaption></figure><h3 id="李雅普诺夫稳定（Lyapunov-stability）"><a href="#李雅普诺夫稳定（Lyapunov-stability）" class="headerlink" title="李雅普诺夫稳定（Lyapunov stability）"></a>李雅普诺夫稳定（Lyapunov stability）</h3><p>李雅普诺夫稳定常用来描述一个动力系统的稳定性.它是指系统在初始条件有微小扰动时，解的轨迹仍然保持在某一邻域内.具体来说，对于每个 $\epsilon &gt; 0$，均存在 $\delta &gt; 0$，使得当初始条件满足 $\lVert x(0) - x^\ast \rVert &lt; \delta$ 时，对于所有 $t \geq {t_0}$，都有 $\lVert x(t) - x^\ast \rVert &lt; \epsilon$，则称平衡点 $x^\ast$ 是李雅普诺夫稳定的.</p><p>在李雅普诺夫稳定的基础上，还可以定义渐近稳定（Asymptotic stability）和指数稳定（Exponential stability）等更强的稳定性概念：</p><ul><li>渐近稳定：若平衡点李雅普诺夫稳定，且系统的解随着时间趋向于平衡点，即 $\lim_{t \to \infty} x(t) &#x3D; x^\ast$ ，则称该平衡点是渐近稳定的.也就是说，渐近稳定不但能维持在平衡点附近，而且最后能收敛到平衡点.</li><li>指数稳定：若平衡点渐近稳定，且存在正数 $\alpha$ 和 $\beta$，使得 $\lVert x(t) - x^\ast \rVert \leq {\alpha} e^{-\beta t} \lVert x(0) - x^\ast \rVert$，则称该平衡点是指数稳定的.指数稳定表明状态函数的收敛速度不慢于某个指数函数的递减速度.</li></ul><h2 id="Lotka-Volterra-模型"><a href="#Lotka-Volterra-模型" class="headerlink" title="Lotka-Volterra 模型"></a>Lotka-Volterra 模型</h2><h3 id="模型概述"><a href="#模型概述" class="headerlink" title="模型概述"></a>模型概述</h3><p>Lotka-Volterra 模型由 Alfred Lotka（1925年）和 Vito Volterra（1926年）提出.该模型运用数学框架（常微分方程）描述自然界生态系统中捕食者与猎物种群数量随时间的动态变化，揭示两者间相互作用关系，对预测种群波动和理解生态系统的稳定性具有重要意义.</p><figure>    <img src="https://media.geeksforgeeks.org/wp-content/uploads/20240430104750/Lotka-Volterra-Model-(1).png" alt="Lotka-Volterra 模型曲线示意图">    <figcaption>Lotka-Volterra 模型曲线示意图.</figcaption></figure><p>Lotka-Volterra 模型通常基于以下基本假设：</p><ol><li>没有捕食者的情况下，猎物数量呈线性或指数增长.</li><li>猎物可捕获性是限制捕食者种群增长的唯一因素.</li><li>没有年龄结构差异，能持续繁殖，捕食者与猎物间具有原子同质性.</li><li>捕食者与猎物的相遇几率和捕食率直接相关.5.捕食者拥有与种群密度无关的恒定死亡率.</li></ol><p>该模型可由一对一阶非线性常微分方程描述：</p><p>$$<br>\begin{cases}<br>\frac{dx}{dt} &#x3D; bx - pxy \\<br>\frac{dy}{dt} &#x3D; rxy - dy<br>\end{cases}<br>\tag{4}<br>$$</p><p>其中变量 $x$ 表示猎物的种群数量，变量 $y$ 表示捕食者的种群数量.参数 $b$ 表示没有捕食者的情况下猎物种群的自发增长率.参数 $d$ 表示没有猎物的情况下捕食者的自然死亡率.乘积 $pxy$ 与 $rxy$ 分别表示由于捕食者存在猎物数量的净减少率，以及由于猎物存在捕食者数量的净增长率，其数值大小与二者种群数量相关.</p><h3 id="稳定性分析"><a href="#稳定性分析" class="headerlink" title="稳定性分析"></a>稳定性分析</h3><p>结合上述方程组，可提出以下问题：猎物与捕食者的种群数量将随时间如何变化？是否存在平衡点与稳定点？如果不稳定，能否形成振荡？持续的振荡需要满足何种参数条件，与初始种群数量是否有关系？</p><h4 id="理论计算"><a href="#理论计算" class="headerlink" title="理论计算"></a>理论计算</h4><p>不难发现，方程组有两个平衡点 $(0,0)$ 与 $(\frac{d}{r}, \frac{b}{p})$.前者 $(0,0)$ 为不具备实际意义的平凡解，即猎物与捕食者的种群数量均为零（不稳定的鞍点），且当某一方的数量出现微小扰动时，便立即呈指数增长，从而偏离该平衡点.考虑第二个解 $(\frac{d}{r}, \frac{b}{p})$，令</p><p>$$<br>\begin{bmatrix}<br>b-py &amp; -px \\<br>ry &amp; rx - d<br>\end{bmatrix} &#x3D; 0<br>\tag{5}<br>$$</p><p>可解得</p><p>$$<br>\lambda _{1,2} &#x3D; \pm i\sqrt{bd} \tag{6}<br>$$</p><p>两个解的实部均等于零，可能为稳定点，也可能不是，需进一步讨论.尽管一般的非线性常微分方程组无法求出近似的通解，但对于本模型而言，在平衡态附近的微小扰动可求出近似通解</p><p>$$<br>\begin{cases}<br>x(t) &#x3D; \frac{d}{r} + \sqrt{c}\ p A_0 \cos(\sqrt{b d}\ t + \phi) \\<br>y(t) &#x3D; \frac{b}{p} + \sqrt{b}\ r A_0 \sin(\sqrt{b d}\ t + \phi)<br>\end{cases}<br>\tag {7}<br>$$</p><p>其中 ${A_0}$ 是与 $x$ 和 $y$ 初值有关的常数.解的周期为</p><p>$$<br>T &#x3D; \frac{2\pi}{\sqrt{bd}} \tag{8}<br>$$</p><p>由此可见，对于微小扰动，系统会在平衡点附近做周期性振荡，即 $(\frac{d}{r}, \frac{b}{p})$ 为振荡中心，且振荡的频率与参数 $b$ 和 $d$ 有关.然而，这种振荡并非渐近稳定，因为解不会收敛到平衡点，而是持续围绕平衡点振荡.故此捕食者-猎物动态系统不存在稳定点.</p><h4 id="数值模拟"><a href="#数值模拟" class="headerlink" title="数值模拟"></a>数值模拟</h4><p>用 MATLAB 软件对相关数值进行模拟，以验证结果正确性，并研究不同初始条件（$x$、$y$ 的初值）下种群数量的变化趋势.相关代码如下：</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">% Example of Lotka-Volterra Model Simulation</span></span><br><span class="line"><span class="comment">% Parameters</span></span><br><span class="line">b=<span class="number">1</span>;</span><br><span class="line">p=<span class="number">0.01</span>;</span><br><span class="line">r=<span class="number">0.01</span>;</span><br><span class="line">d=<span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">% ODE Solver</span></span><br><span class="line">PredatorPrey=@(t,z)[b*z(<span class="number">1</span>)-p*z(<span class="number">1</span>)*z(<span class="number">2</span>);r*z(<span class="number">1</span>)*z(<span class="number">2</span>)-d*z(<span class="number">2</span>)];</span><br><span class="line">[t,z]=ode45(PredatorPrey,[<span class="number">0</span>,<span class="number">50</span>],[<span class="number">250</span>,<span class="number">50</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">% Plotting Results</span></span><br><span class="line">subplot(<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>);</span><br><span class="line"><span class="built_in">plot</span>(t,z(:,<span class="number">1</span>),<span class="string">&quot;r-&quot;</span>,t,z(:,<span class="number">2</span>),<span class="string">&quot;b-&quot;</span>);</span><br><span class="line"><span class="built_in">legend</span>(<span class="string">&#x27;Prey&#x27;</span>,<span class="string">&#x27;Predator&#x27;</span>)</span><br><span class="line">xlabel(<span class="string">&#x27;T&#x27;</span>);</span><br><span class="line">ylabel(<span class="string">&#x27;Number of Predator/Prey&#x27;</span>);</span><br><span class="line">title(<span class="string">&#x27;Curve of Lotka-Volterra Model&#x27;</span>);</span><br><span class="line">grid on;</span><br><span class="line">subplot(<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>);</span><br><span class="line"><span class="built_in">plot</span>(z(:,<span class="number">1</span>),z(:,<span class="number">2</span>))</span><br><span class="line">title(<span class="string">&#x27;Phase Space&#x27;</span>)</span><br><span class="line">grid on;</span><br></pre></td></tr></table></figure><h5 id="验证-frac-d-r-frac-b-p-的平衡点特性"><a href="#验证-frac-d-r-frac-b-p-的平衡点特性" class="headerlink" title="验证 $(\frac{d}{r}, \frac{b}{p})$ 的平衡点特性"></a>验证 $(\frac{d}{r}, \frac{b}{p})$ 的平衡点特性</h5><p>设置参数 $b&#x3D;1$，$d&#x3D;2$，$p&#x3D;r&#x3D;0.01$，则平衡点为 $(200,100)$.</p><p>设初值 $$(x_0,y_0) &#x3D; (200,100)$$，在无扰动的情况下，种群数量保持不变，符合平衡点的特性.（下列所有结果图中，左边为种群数量变化曲线，红色代表猎物，蓝色代表捕食者；右边为相平面轨迹图.）</p><figure>    <img src="https://github.com/Louis-wemby/Louis-wemby.github.io/blob/main/blog/source/figure/posts/Lotka-Volterra_model/result1.png?raw=true" alt="Lotka-Volterra 模型模拟结果1">    <figcaption>初值设为平衡点 $(200,100)$ 时的模拟结果.</figcaption></figure><p>任取初值如 $$(x_0,y_0) &#x3D; (199,99)$$，可见种群数量围绕平衡点做周期性振荡.</p><figure>    <img src="https://github.com/Louis-wemby/Louis-wemby.github.io/blob/main/blog/source/figure/posts/Lotka-Volterra_model/result2.png?raw=true" alt="Lotka-Volterra 模型模拟结果2">    <figcaption>初值设为 $(199,99)$ 时的模拟结果.</figcaption></figure><p>再如初值 $$(x_0,y_0) &#x3D; (10,20)$$，同样可见种群数量围绕平衡点做周期性振荡.</p><figure>    <img src="https://github.com/Louis-wemby/Louis-wemby.github.io/blob/main/blog/source/figure/posts/Lotka-Volterra_model/result3.png?raw=true" alt="Lotka-Volterra 模型模拟结果3">    <figcaption>初值设为 $(10,20)$ 时的模拟结果.</figcaption></figure><p>由此可见，在不同初始条件下，种群数量均围绕平衡点 $(200,100)$ 做周期性振荡，验证了理论计算结果的正确性.然而，当初始条件偏离平衡点较近时，振荡幅度较小，相平面轨迹近似椭圆形闭合轨道；当初始条件偏离平衡点较远时，振荡幅度较大，相平面轨迹与椭圆形或圆形相差甚远，这是因为在鞍点 $(0,0)$ 附近取初值时，其相空间行为表现出一定的鞍点特征.上述结果表明振荡的幅度与初始条件有关，但振荡的频率（周期）仅与参数 $b$ 和 $d$ 有关.</p><h5 id="固定参数条件下不同初值对曲线变化趋势的影响"><a href="#固定参数条件下不同初值对曲线变化趋势的影响" class="headerlink" title="固定参数条件下不同初值对曲线变化趋势的影响"></a>固定参数条件下不同初值对曲线变化趋势的影响</h5><p>在平衡点附近各自取初值 $$(x_0,y_0) &#x3D; (202,98)$$，</p><figure>    <img src="https://github.com/Louis-wemby/Louis-wemby.github.io/blob/main/blog/source/figure/posts/Lotka-Volterra_model/result4.png?raw=true" alt="Lotka-Volterra 模型模拟结果4">    <figcaption>初值设为 $(202,98)$ 时的模拟结果.</figcaption></figure><p>此时，发现两曲线并没有交点，两者种群数量分别在各自平衡点附近做振幅较小的周期性振荡.</p><p>再分别取$$(x_0,y_0) &#x3D; (250,50)$$ 和 $$(x_0,y_0) &#x3D; (1000,500)$$，可见种群数量虽然围绕平衡点做周期性振荡，但振荡幅度差异显著.尤其当偏离平衡位置较远时，振荡幅度可变得极其剧烈，不稳定的性质愈加明显.</p><figure>    <img src="https://github.com/Louis-wemby/Louis-wemby.github.io/blob/main/blog/source/figure/posts/Lotka-Volterra_model/result5.png?raw=true" alt="Lotka-Volterra 模型模拟结果5">    <figcaption>初值设为 $(250,50)$ 时的模拟结果.</figcaption></figure><figure>    <img src="https://github.com/Louis-wemby/Louis-wemby.github.io/blob/main/blog/source/figure/posts/Lotka-Volterra_model/result6.png?raw=true" alt="Lotka-Volterra 模型模拟结果6">    <figcaption>初值设为 $(1000,500)$ 时的模拟结果.</figcaption></figure><p>改变常微分方程组的参数值，使其均变为原来的两倍，即 $b&#x3D;2$，$d&#x3D;4$，$p&#x3D;r&#x3D;0.02$，此时平衡点仍为 $(200,100)$.</p><p>设初值 $$(x_0,y_0) &#x3D; (250,50)$$.通过与前面结果的对比，可以发现种群数量依然围绕平衡点做周期性振荡，波动幅度（波峰和波谷）不变，但振荡频率更快，周期变小为原来的一半.</p><figure>    <img src="https://github.com/Louis-wemby/Louis-wemby.github.io/blob/main/blog/source/figure/posts/Lotka-Volterra_model/result7.png?raw=true" alt="Lotka-Volterra 模型模拟结果7">    <figcaption>参数变为原来两倍，初值设为 $(250,50)$ 时的模拟结果.</figcaption></figure><h3 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h3><p>通过理论分析与数值模拟，可以得出以下结论：Lotka-Volterra 模型的平衡点并非稳定点，而是振荡中心，种群数量会围绕该点持续振荡.在参数固定即平衡点不变的情况下，种群的初始数量会影响其变化趋势.其规律为：初始数量越接近平衡点，波动幅度越小；越偏离平衡点，波动幅度越大.因此，种群数量初始值与平衡点的差异在一定程度上可反映该系统的稳健性，即在微小干扰下种群数量是否会出现较大波动.然而，振荡的周期性不受种群初始数量的影响，所有变化曲线均表现出固定的周期性，其大小仅与参数 $b$ 和 $d$ 有关.</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>Lotka-Volterra 模型是研究生态系统中捕食者与猎物种间关系这类动态系统的有力工具，能帮助我们了解不同物种在自然界中如何共存.但 Lotka-Volterra 模型也有其局限性，因为自然界是极其复杂的系统，影响种群数量与种间关系的因素是多方面的，难以被单一模型全部囊括.因此，在该模型的基础上，需要不断进行修正，如引入新的变量参数、考虑更高阶的模型，以求尽可能地捕获真实世界的复杂性.</p><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><ol><li><a href="https://en.wikipedia.org/wiki/Lyapunov_stability">Lyapunov stability</a></li><li>GeeksforGeeks. (2024, April 30). Lotka-Volterra Model of Predator-Prey Relationship. GeeksforGeeks. <a href="https://www.geeksforgeeks.org/lotka-volterra-model-of-predator-prey-relationship/">https://www.geeksforgeeks.org/lotka-volterra-model-of-predator-prey-relationship/</a></li><li>闵靖涛. (2018). Lotka-Volterra 模型的性质及生态学意义. 北京大学地球与空间科学学院地球物理系.</li></ol>]]></content>
      
      
      <categories>
          
          <category> Exploration </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Modeling </tag>
            
            <tag> Dynamics </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>构建 SAW 分析参考索引</title>
      <link href="/2026/01/11/SAW-makeRef/"/>
      <url>/2026/01/11/SAW-makeRef/</url>
      
        <content type="html"><![CDATA[<p>在运行 SAW (Stereo-seq Analysis Workflow) count 分析前，需要先生成参考基因组索引 (index).这一步可以由 <code>SAW makeRef</code> 流程分析实现.我们需要提供的输入文件为参考基因组序列 <code>reference.fna</code> 和对应的注释文件 <code>reference.gff/gtf</code>.</p><h2 id="miniprot-基因注释"><a href="#miniprot-基因注释" class="headerlink" title="miniprot 基因注释"></a>miniprot 基因注释</h2><p>由于原先的参考基因组 <code>Larus_argentatus.fna</code> 并未注释出关键的三个视蛋白 (Opsins) 基因 <em>OPN1SW</em>、<em>OPN2SW</em> 与 <em>OPN1LW</em>，因此需要重新对参考基因组进行注释，选用的软件为 <strong>miniprot</strong>，具体注释方法在此不展开论述.最终只注释出位于 Chr1 的 <em>OPN2SW</em> 基因，需要添加的另外两个基因序列所在染色体分别为 <a href="https://www.ncbi.nlm.nih.gov/nuccore/CAYQHM010000238.1">CAYQHM010000238.1.fna</a> 和 <a href="https://www.ncbi.nlm.nih.gov/nuccore/OZ207386.1/">OZ207386.1.fna</a>，<strong>miniprot</strong> 注释输出的 <code>GFF3</code> 格式文件分别为 <code>CAYQHM010000238.1.gff</code> 和 <code>OZ207386.1.gff</code>.</p><h2 id="注释文件格式转换"><a href="#注释文件格式转换" class="headerlink" title="注释文件格式转换"></a>注释文件格式转换</h2><p>原先的基因组注释文件为 <code>.gtf</code> 格式，因此需将 <code>CAYQHM010000238.1.gff</code>和 <code>OZ207386.1.gff</code> 转换为 GTF 格式.所用脚本如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse_attributes</span>(<span class="params">attr_str</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;解析 GFF 属性列为字典&quot;&quot;&quot;</span></span><br><span class="line">    attrs = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> attr_str.strip(<span class="string">&#x27;;&#x27;</span>).split(<span class="string">&#x27;;&#x27;</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;=&#x27;</span> <span class="keyword">in</span> item:</span><br><span class="line">            k, v = item.split(<span class="string">&#x27;=&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">            attrs[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="string">&#x27; &#x27;</span> <span class="keyword">in</span> item: <span class="comment"># 处理某些类 GTF 格式</span></span><br><span class="line">            parts = item.strip().split(<span class="string">&#x27; &#x27;</span>, <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(parts) == <span class="number">2</span>:</span><br><span class="line">                attrs[parts[<span class="number">0</span>]] = parts[<span class="number">1</span>].strip(<span class="string">&#x27;&quot;&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> attrs</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">convert_gff_to_gtf</span>(<span class="params">input_file</span>):</span><br><span class="line">    genes = &#123;&#125; <span class="comment"># 存储基因信息</span></span><br><span class="line">    transcripts = &#123;&#125; <span class="comment"># 存储转录本信息 &#123;rna_id: [feature_lines]&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(input_file, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> f:</span><br><span class="line">            <span class="keyword">if</span> line.startswith(<span class="string">&#x27;#&#x27;</span>) <span class="keyword">or</span> <span class="keyword">not</span> line.strip():</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            </span><br><span class="line">            cols = line.strip().split(<span class="string">&#x27;\t&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(cols) &lt; <span class="number">9</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">                </span><br><span class="line">            feature_type = cols[<span class="number">2</span>]</span><br><span class="line">            attributes = parse_attributes(cols[<span class="number">8</span>])</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> feature_type == <span class="string">&#x27;mRNA&#x27;</span>:</span><br><span class="line">                rna_id = attributes.get(<span class="string">&#x27;ID&#x27;</span>)</span><br><span class="line">                <span class="comment"># 如果没有 Parent，则用 rna_id 作为 gene_id</span></span><br><span class="line">                gene_id = attributes.get(<span class="string">&#x27;Parent&#x27;</span>, rna_id)</span><br><span class="line">                transcripts[rna_id] = &#123;</span><br><span class="line">                    <span class="string">&#x27;info&#x27;</span>: cols,</span><br><span class="line">                    <span class="string">&#x27;gene_id&#x27;</span>: gene_id,</span><br><span class="line">                    <span class="string">&#x27;features&#x27;</span>: []</span><br><span class="line">                &#125;</span><br><span class="line">            <span class="keyword">elif</span> feature_type <span class="keyword">in</span> [<span class="string">&#x27;CDS&#x27;</span>, <span class="string">&#x27;exon&#x27;</span>, <span class="string">&#x27;five_prime_utr&#x27;</span>, <span class="string">&#x27;three_prime_utr&#x27;</span>]:</span><br><span class="line">                rna_id = attributes.get(<span class="string">&#x27;Parent&#x27;</span>)</span><br><span class="line">                <span class="keyword">if</span> rna_id <span class="keyword">in</span> transcripts:</span><br><span class="line">                    transcripts[rna_id][<span class="string">&#x27;features&#x27;</span>].append(cols)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 开始输出</span></span><br><span class="line">    <span class="keyword">for</span> rna_id, data <span class="keyword">in</span> transcripts.items():</span><br><span class="line">        t_info = data[<span class="string">&#x27;info&#x27;</span>]</span><br><span class="line">        gene_id = data[<span class="string">&#x27;gene_id&#x27;</span>]</span><br><span class="line">        chrom, source, _, start, end, score, strand, frame = t_info[:<span class="number">8</span>]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 1. 输出 gene 行</span></span><br><span class="line">        gene_attr = <span class="string">f&#x27;gene_id &quot;<span class="subst">&#123;gene_id&#125;</span>&quot;; gene_name &quot;<span class="subst">&#123;gene_id&#125;</span>&quot;; gene_biotype &quot;protein-coding&quot;;&#x27;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;chrom&#125;</span>\t<span class="subst">&#123;source&#125;</span>\tgene\t<span class="subst">&#123;start&#125;</span>\t<span class="subst">&#123;end&#125;</span>\t<span class="subst">&#123;score&#125;</span>\t<span class="subst">&#123;strand&#125;</span>\t.\t<span class="subst">&#123;gene_attr&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 2. 输出 transcript 行</span></span><br><span class="line">        tran_attr = <span class="string">f&#x27;gene_id &quot;<span class="subst">&#123;gene_id&#125;</span>&quot;; transcript_id &quot;<span class="subst">&#123;rna_id&#125;</span>&quot;; gene_name &quot;<span class="subst">&#123;gene_id&#125;</span>&quot;; gene_biotype &quot;protein-coding&quot;;&#x27;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;chrom&#125;</span>\t<span class="subst">&#123;source&#125;</span>\ttranscript\t<span class="subst">&#123;start&#125;</span>\t<span class="subst">&#123;end&#125;</span>\t<span class="subst">&#123;score&#125;</span>\t<span class="subst">&#123;strand&#125;</span>\t.\t<span class="subst">&#123;tran_attr&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 3. 输出子特征 (CDS/Exon)</span></span><br><span class="line">        <span class="comment"># 如果 GFF 里只有 CDS 没有 exon，GTF 必须补全 exon</span></span><br><span class="line">        has_exon = <span class="built_in">any</span>(f[<span class="number">2</span>] == <span class="string">&#x27;exon&#x27;</span> <span class="keyword">for</span> f <span class="keyword">in</span> data[<span class="string">&#x27;features&#x27;</span>])</span><br><span class="line">        </span><br><span class="line">        exon_count = <span class="number">0</span></span><br><span class="line">        cds_count = <span class="number">0</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 排序特征坐标 (正链升序，负链降序)</span></span><br><span class="line">        sorted_features = <span class="built_in">sorted</span>(data[<span class="string">&#x27;features&#x27;</span>], key=<span class="keyword">lambda</span> x: <span class="built_in">int</span>(x[<span class="number">3</span>]))</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> feat <span class="keyword">in</span> sorted_features:</span><br><span class="line">            f_type = feat[<span class="number">2</span>]</span><br><span class="line">            f_start, f_end, f_score, f_strand, f_frame = feat[<span class="number">3</span>], feat[<span class="number">4</span>], feat[<span class="number">5</span>], feat[<span class="number">6</span>], feat[<span class="number">7</span>]</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 生成通用属性前缀</span></span><br><span class="line">            base_attr = <span class="string">f&#x27;gene_id &quot;<span class="subst">&#123;gene_id&#125;</span>&quot;; transcript_id &quot;<span class="subst">&#123;rna_id&#125;</span>&quot;; gene_name &quot;<span class="subst">&#123;gene_id&#125;</span>&quot;;&#x27;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># 处理 CDS 和 自动生成 exon</span></span><br><span class="line">            <span class="keyword">if</span> f_type == <span class="string">&#x27;CDS&#x27;</span>:</span><br><span class="line">                cds_count += <span class="number">1</span></span><br><span class="line">                <span class="comment"># 如果原始数据没写 exon，把 CDS 当作 exon 输出一次</span></span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> has_exon:</span><br><span class="line">                    exon_count += <span class="number">1</span></span><br><span class="line">                    ex_attr = base_attr + <span class="string">f&#x27; exon_id &quot;<span class="subst">&#123;rna_id&#125;</span>.exon.<span class="subst">&#123;exon_count&#125;</span>&quot;;&#x27;</span></span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;chrom&#125;</span>\t<span class="subst">&#123;source&#125;</span>\texon\t<span class="subst">&#123;f_start&#125;</span>\t<span class="subst">&#123;f_end&#125;</span>\t<span class="subst">&#123;f_score&#125;</span>\t<span class="subst">&#123;f_strand&#125;</span>\t.\t<span class="subst">&#123;ex_attr&#125;</span>&quot;</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># 输出 CDS</span></span><br><span class="line">                c_attr = base_attr + <span class="string">f&#x27; exon_id &quot;<span class="subst">&#123;rna_id&#125;</span>.cds.<span class="subst">&#123;cds_count&#125;</span>&quot;;&#x27;</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;chrom&#125;</span>\t<span class="subst">&#123;source&#125;</span>\tCDS\t<span class="subst">&#123;f_start&#125;</span>\t<span class="subst">&#123;f_end&#125;</span>\t<span class="subst">&#123;f_score&#125;</span>\t<span class="subst">&#123;f_strand&#125;</span>\t<span class="subst">&#123;f_frame&#125;</span>\t<span class="subst">&#123;c_attr&#125;</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">elif</span> f_type == <span class="string">&#x27;exon&#x27;</span>:</span><br><span class="line">                exon_count += <span class="number">1</span></span><br><span class="line">                ex_attr = base_attr + <span class="string">f&#x27; exon_id &quot;<span class="subst">&#123;rna_id&#125;</span>.exon.<span class="subst">&#123;exon_count&#125;</span>&quot;;&#x27;</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;chrom&#125;</span>\t<span class="subst">&#123;source&#125;</span>\texon\t<span class="subst">&#123;f_start&#125;</span>\t<span class="subst">&#123;f_end&#125;</span>\t<span class="subst">&#123;f_score&#125;</span>\t<span class="subst">&#123;f_strand&#125;</span>\t.\t<span class="subst">&#123;ex_attr&#125;</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># 处理 UTR 等其他特征</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;chrom&#125;</span>\t<span class="subst">&#123;source&#125;</span>\t<span class="subst">&#123;f_type&#125;</span>\t<span class="subst">&#123;f_start&#125;</span>\t<span class="subst">&#123;f_end&#125;</span>\t<span class="subst">&#123;f_score&#125;</span>\t<span class="subst">&#123;f_strand&#125;</span>\t<span class="subst">&#123;f_frame&#125;</span>\t<span class="subst">&#123;base_attr&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(sys.argv) &lt; <span class="number">2</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Usage: python gff2gtf.py input.gff&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        convert_gff_to_gtf(sys.argv[<span class="number">1</span>])</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example</span></span><br><span class="line">python gff2gtf.py CAYQHM010000238.1.gff &gt; OPN1LW.gtf</span><br></pre></td></tr></table></figure><p>格式转换成功后，建议将 <code>gene_id</code>、<code>gene_name</code>、<code>transcript_id</code> 等改为基因名（<strong>miniprot</strong> 自动输出的标识为 <code>MPXXXXXX</code>），其余命名格式与原先 GTF 文件相同，如一个转录本（transcript）有多个 exon&#x2F;CDS 时，用 exon.1&#x2F;.2&#x2F;… 和 cds.1&#x2F;.2&#x2F;… 加以区分.</p><h2 id="添加序列与注释文件"><a href="#添加序列与注释文件" class="headerlink" title="添加序列与注释文件"></a>添加序列与注释文件</h2><p>在 <strong>Linux</strong> 终端，用如下命令将基因序列与注释信息添加进原有的基因组序列与注释文件中：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example</span></span><br><span class="line"><span class="comment"># Chr1 放最前面</span></span><br><span class="line"><span class="built_in">cat</span> OPN2SW.gtf Larus_argentatus.gtf OPN1LW.gtf OPN1SW.gtf &gt; Larus_argentatus_v1.gtf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除 &#x27;&gt;&#x27; 后多余信息</span></span><br><span class="line"><span class="built_in">cat</span> Larus_argentatus.fna CAYQHM010000238.1.fna OZ207386.1.fna | sed -e <span class="string">&quot;s/&gt;OZ207386.1 Larus argentatus genome assembly, chromosome: 1/&gt;OZ207386.1/g&quot;</span> -e <span class="string">&quot;s/&gt;CAYQHM010000238.1 Larus argentatus genome assembly, contig: HAP1_SCAFFOLD_368, whole genome shotgun sequence/&gt;CAYQHM010000238.1/g&quot;</span> &gt; Larus_argentatus_v1.fna</span><br></pre></td></tr></table></figure><h2 id="运行-SAW-makeRef"><a href="#运行-SAW-makeRef" class="headerlink" title="运行 SAW makeRef"></a>运行 SAW makeRef</h2><p>由于需进行转录组比对，所选用的 Mode 为 <a href="https://academic.oup.com/bioinformatics/article/29/1/15/272537"><strong>STAR</strong></a>.若在终端运行，则命令如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &#x27;transcript&#x27; 为存放结果文件创建的文件夹</span></span><br><span class="line">saw makeRef \</span><br><span class="line">    --mode=STAR \</span><br><span class="line">    --fasta=Larus_argentatus_v1.fna \</span><br><span class="line">    --gtf=Larus_argentatus_v1.gtf \</span><br><span class="line">    --genome=./transcript</span><br></pre></td></tr></table></figure><p>关于 <code>SAW makeRef</code> 更多用法，可见参考文献 1.</p><h2 id="⚠️-注意事项"><a href="#⚠️-注意事项" class="headerlink" title="⚠️ 注意事项"></a>⚠️ 注意事项</h2><ol><li><code>fna</code> 文件中的染色体&#x2F;Scaffold 等标识符必须唯一，不能重复，且需和 <code>gtf</code> 文件中的对应.</li><li>在拼接完基因组序列后，建议检查文件大小&#x2F;行数，防止有碱基序列丢失.可用 <code>wc -l</code> 打印行数，或者 <code>grep -v &#39;&gt;&#39; filename | tr -d &#39;\n&#39; | wc -w</code> 精确统计碱基个数（去除 Header 信息）.</li><li>注释文件中的起止坐标不能超过所在染色体&#x2F;Scaffold 的总长度，否则构建索引会报错.</li></ol><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><ol><li><a href="https://www.stomics.tech/service/saw_8_2/docs/shi-yong-jiao-cheng/bi-dui-wen-jian/gou-jian-suo-yin-wen-jian.html">构建索引文件</a></li><li><a href="https://academic.oup.com/bioinformatics/article/29/1/15/272537">STAR: ultrafast universal RNA-seq aligner</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Tutorial </category>
          
      </categories>
      
      
        <tags>
            
            <tag> BGI </tag>
            
            <tag> Stereo-seq </tag>
            
            <tag> Genomics </tag>
            
            <tag> Spatial Transcriptomics </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2026/01/05/hello-world/"/>
      <url>/2026/01/05/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      <categories>
          
          <category> hello world </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Initial config </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
